rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Rules for the clients collection
    match /clients/{clientId} {
      // A user can read a client document if they are the owner.
      // This applies to both get() and list() queries.
      // The client-side query MUST use a where("userId", "==", request.auth.uid) clause.
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      
      // A user can create, update, or delete a client document if they are the owner.
      allow write: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }

    // Rules for the text_blocks collection
    match /text_blocks/{textBlockId} {
      // A user can read their own text blocks.
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      
      // A user can write to their own text blocks.
      allow write: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }

    // Rules for the doc_templates collection
    match /doc_templates/{docTemplateId} {
      // A user can read their own document templates.
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      
      // A user can write to their own document templates.
      allow write: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
  }
}
